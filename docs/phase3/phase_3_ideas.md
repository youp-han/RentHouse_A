# RentHouse 프로젝트 Phase 3 주요 기능 아이디어

이 문서는 Phase 2 완료 이후에 고려할 주요 기능인 **보안/RBAC**와 **유지보수(Work Order)**에 대한 상세 아이디어를 정리합니다.

---

## 1. 보안 및 역할 기반 접근 제어 (Security & RBAC)

### 1.1. 목표
- 민감 데이터를 보호하고, 사용자 역할에 따라 접근 가능한 기능과 데이터를 제한합니다.
- 백엔드 연동 전, 프론트엔드 수준에서 우선적으로 적용 가능한 보안 가드 전략을 수립합니다.

### 1.2. 주요 구현 아이디어

- **역할/권한 모델 정의**
  - **역할(Roles):** `OWNER`, `ADMIN`, `MANAGER`, `ACCOUNTANT`, `STAFF`, `READONLY` 등 세분화된 역할 정의
  - **권한(Permissions):** 각 역할에 따라 모듈별 액션(`read`, `create`, `update`, `delete`, `export`)에 대한 권한 부여

- **접근 제어 구현**
  - **라우팅 가드:** `go_router.redirect`를 사용하여 사용자의 역할이 특정 경로에 접근할 수 있는지 검사합니다.
  - **위젯 가드:** `can('feature.action')` 형태의 헬퍼 함수를 만들어, 권한에 따라 UI 요소(버튼, 메뉴 등)를 동적으로 보여주거나 숨깁니다.

- **로컬 데이터 및 인증 보안**
  - **로컬 DB 암호화:** `Drift`와 `SQLCipher` 또는 `sqlite_crypt`를 연동하여 로컬 데이터베이스 파일을 암호화합니다. 암호화 키는 `flutter_secure_storage`에 안전하게 보관합니다.
  - **민감 정보 보호:** 주민등록번호, 연락처 등 개인식별정보(PII)는 UI에 표시될 때 항상 마스킹 처리합니다.
  - **로그인 보안:** 로그인 실패 횟수를 제한하여 일정 시간 동안 앱을 잠그는 기능을 구현합니다.

- **감사 및 로깅**
  - **감사 로그(Audit Log):** 주요 데이터 변경(생성, 수정, 삭제) 발생 시 `누가, 언제, 무엇을, 어떻게` 변경했는지 로그를 기록하는 테이블을 추가합니다.
  - **에러/크래시 리포팅:** `Sentry` 등의 서비스를 연동하여 앱의 오류 및 비정상 종료를 추적하되, 로그 전송 시 민감 정보는 제외(Scrubbing)합니다.

> **참고:** 프론트엔드 보안은 사용자의 실수를 방지하는 데 중점을 두며, 완전한 보안은 백엔드 API를 통해 검증되어야 합니다.

---

## 2. 유지보수 관리 (Work Order)

### 2.1. 목표
- 건물 유지보수 요청의 접수부터 처리, 완료까지 전 과정을 체계적으로 추적하고 관리합니다.

### 2.2. 데이터 모델 제안

- **`WorkOrder`**: 작업 지시서
  - `id`, `unit_id` (어느 유닛), `title` (작업명), `category` (카테고리: 전기, 배관 등), `priority` (우선순위), `status` (상태), `dueDate` (처리 기한), `assignee` (담당자) 등
  - **상태(Status):** `OPEN` → `ASSIGNED` → `IN_PROGRESS` → `DONE` → `CANCELLED`
  - **우선순위(Priority):** `LOW`, `NORMAL`, `HIGH`, `URGENT`

- **`WorkOrderActivity`**: 작업 이력
  - `work_order_id`, `type` (코멘트, 상태 변경, 사진 첨부 등), `comment`, `createdAt` 등

- **`Attachment`**: 첨부 파일
  - 작업 전/후 사진, 영수증 등 파일 정보 관리

### 2.3. 핵심 플로우

1.  **접수:** 관리자가 유지보수 필요 사항을 등록합니다 (카테고리, 우선순위 설정).
2.  **할당:** 작업을 처리할 담당자를 지정합니다.
3.  **진행:** 담당자가 코멘트, 작업 사진 등을 기록하며 상태를 업데이트합니다.
4.  **완료:** 작업 완료 후 결과를 보고하고, 관리자가 최종 확인합니다.

### 2.4. UI/UX 아이디어

- **목록 및 칸반 보드:** 작업 목록을 리스트 형태와 상태별 칸반 보드 형태로 모두 볼 수 있도록 제공합니다.
- **필터 및 정렬:** 자산, 유닛, 우선순위, 상태 등으로 작업을 필터링하고 정렬하는 기능을 제공합니다.
- **상세 화면:** 작업의 모든 이력(코멘트, 사진, 상태 변경)을 타임라인 형태로 보여줍니다.
- **기능 연계:** 입주/퇴실 체크리스트에서 '수리 필요' 항목을 체크하면 바로 유지보수 작업오더를 생성할 수 있는 바로가기를 제공합니다.
