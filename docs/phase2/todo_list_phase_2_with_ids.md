# RentHouse 프로젝트 Phase 2 To-Do 리스트

Phase 1 완료 보고서와 추가 요구사항을 바탕으로 Phase 2에서 진행할 작업 목록을 정리합니다.

## 1. 신규 기능 (New Features)

- [ ] (task100) **회원가입 기능 추가**
    - [ ] (task101) 이메일, 이름, 암호 입력 폼 구현
    - [ ] (task102) 암호는 암호화하여 저장
- [ ] (task103) **사용자 설정(Settings) 화면 구현**
    - [ ] (task104) 프로필 관리 화면
        - [ ] (task105) 개인정보(이름 등) 수정 기능
        - [ ] (task106) 암호 변경 기능
        - [ ] (task107) 회원 탈퇴 기능
    - [ ] (task108) 통화(Currency) 설정 기능 (원, 달러 등)
    - [ ] (task109) 로그인/로그아웃 기능 연동
- [ ] (task110) **고객 관리 기능 추가**
    - [ ] (task111) 자산 소유자가 앱 사용자의 고객인 경우를 위한 고객 관리 화면 구현
    - [ ] (task112) 고객 정보 (이름, 이메일 등) CRUD 기능

- [ ] (task113) **수익 관리 기능 상세 구현 (Revenue Management)**
    - [ ] (task114) **데이터 모델 확장 및 신규 생성**
        - [ ] (task115) `Billing` 모델: `status` 필드 추가 (`DRAFT`, `ISSUED`, `PAID`, `OVERDUE` 등 6개 상태)
        - [ ] (task116) `BillingItem` 모델: `quantity`, `unitPrice`, `tax`, `memo` 등 상세 필드 추가
        - [ ] (task117) `Payment` 모델 신규 생성: 수납 정보(결제수단, 금액, 날짜 등) 관리
        - [ ] (task118) `PaymentAllocation` 모델 신규 생성: 단일 수납 건을 여러 청구서에 배분하는 기능 지원
    - [ ] (task119) **핵심 워크플로우 구현**
        - [ ] (task120) **반자동 청구 생성:** 사용자가 버튼을 눌러 특정 월의 청구서를 일괄 생성 (중복 생성 방지 로직 포함)
        - [ ] (task121) **수납 등록 및 자동 배분:** 수납 금액 등록 시 가장 오래된 미납 청구서부터 자동 배분하는 기능 구현
        - [ ] (task122) **영수증 발행:** 수납 내역을 바탕으로 PDF 영수증을 생성하는 기능
    - [ ] (task123) **UI/UX 개선**
        - [ ] (task124) **대시보드 KPI:** '이번 달 미납액', '연체 비중' 등 수익 관련 핵심 지표 추가
        - [ ] (task125) **청구 목록 화면:** 상태별 배지 표시, 연체 필터, '대량 선택 후 일괄 발행' 기능 추가
        - [ ] (task126) **수납 화면:** 자동 배분 결과 미리보기, 수동 배분 기능 UI 구현

- [ ] (task127) **보고서 기능 구체화**
    - [ ] (task128) **월별 수익 보고서:** 청구액 vs 수납액, 전년 동월 대비 증감 표시
    - [ ] (task129) **연체 보고서:** 임차인 및 유닛별 연체 현황 리포트
    - [ ] (task130) **점유율 보고서:** 공실로 인한 잠재 수익 손실 추정 리포트

## 2. 기존 기능 개선 및 변경 (Improvements & Changes)

### 2.1. 자산 (Property) 및 유닛 (Unit)
- [ ] (task131) **자산 데이터 모델 변경**
    - [ ] (task132) `자산 유형` 필드를 DropdownList로 변경 (`다가구 (빌라)`, `아파트`, `오피스`, `주택`, `상가`, `토지`)
    - [ ] (task133) `층수` 필드 제거
    - [ ] (task134) `소유자 정보` 필드 추가 (고객관리 기능과 연동)
    - [ ] (task135) `계약 종류` 필드 추가 (`전세`, `월세`, `반전세`)
    - [ ] (task136) 주소 필드를 `우편번호(zip)`, `주소1(add1)`, `상세주소(add2)`로 구조 변경
- [ ] (task137) **우편번호 검색 API 연동**
    - [ ] (task138) 자산 등록/수정 시 다음 우편번호 API 등을 사용하여 주소 입력 기능 구현
- [ ] (task139) **유닛 데이터 모델 변경**
    - [ ] (task140) `임대 상태` 필드를 DropdownList로 변경 (`임대 중`, `공실`)

### 2.2. 임차인 (Tenant)
- [ ] (task141) **주민등록번호 저장 방식 변경**
    - [ ] (task142) 입력된 주민등록번호를 `생년월일`과 `뒷자리 첫번째 숫자`로 분리하여 저장 (`bday`, `personalNo` 필드 활용)
    - [ ] (task143) UI에서는 마스킹 처리하여 표시 (`750331-1******`)

### 2.3. 임대 계약 (Lease)
- [ ] (task144) **임대 계약 등록 화면 개선**
    - [ ] (task145) **임차인 선택**: 현재 다른 계약이 없는 임차인만 목록에 표시
    - [ ] (task146) **신규 임차인 추가**: 임차인 목록 하단에 "임차인 등록" 버튼 추가하여 바로 신규 임차인 등록 폼으로 이동하는 기능 구현
    - [ ] (task147) **자산-유닛 연동 선택**:
        - [ ] (task148) `자산`을 먼저 선택
        - [ ] (task149) 선택된 자산에 속한 `유닛`들만 목록에 표시
        - [ ] (task150) 자산에 유닛이 없으면 유닛 선택 목록 비활성화/숨김 처리

### 2.4. 청구 (Billing)
- [ ] (task151) **계약별 기본 청구 항목 추가**
    - [ ] (task152) 청구서 생성 시 계약 정보에 따라 `주차비`, `관리비`, `물세` 등 기본 항목을 자동으로 추가하는 기능 고려

### 2.5. UI/UX
- [ ] (task153) **반응형 내비게이션 개선**
    - [ ] (task154) 모바일/세로/좁은 화면에서는 내비게이션 바가 화면 하단에 위치하도록 `MainLayout` 로직 강화

## 3. 기술 부채 및 기타 작업 (Technical Debt & Chores)

- [ ] (task155) **데이터베이스 마이그레이션**
    - [ ] (task156) 변경된 데이터 모델(`Billing`, `Property` 등)에 맞춰 `drift` 스키마 버전업 및 마이그레이션 전략 수립/실행
    - [ ] (task157) `(lease_id, yearMonth)`에 대한 유니크 인덱스 추가하여 중복 청구 방지
- [ ] (task158) **테스트 코드 작성**
    - [ ] (task159) Phase 1에서 구현된 기능 및 Phase 2 신규/변경 기능에 대한 단위, 위젯, 통합 테스트 코드 작성
- [ ] (task160) **활동 로그 구현**
    - [ ] (task161) 대시보드에 주요 활동(CRUD)에 대한 로그를 표시하는 기능 구현
- [ ] (task162) **로깅 및 크래시 보고 시스템 통합**
    - [ ] (task163) `logger`, `sentry_flutter` 등을 활용하여 앱 로깅 및 에러 리포팅 시스템 구축