# RentHouse PRD — UI/UX & Flutter Addendum
_작성일: 2025-09-05 04:52:37_

## 1) 배경
기존 PRD에는 **UI/UX 상세 설계**와 **Flutter 구현 관점의 구체 사양**(상태관리, 라우팅, RBAC 가드, 컴포넌트 사양)이 빠져 있습니다. 또한 **SB Admin 2 테마는 사용하지 않는** 것으로 확정되었습니다. 본 부록은 Flutter를 기준으로 첫 스프린트를 시작할 수 있을 정도의 **디자인 산출물 요구사항**과 **구현 가이드**를 제공합니다.

---

## 2) 디자인 방향성 (SB Admin 2 미사용)
- **디자인 시스템**: Flutter **Material 3 (M3)** 기반 커스텀 테마.
- **적응형 레이아웃**: 모바일(≤600), 태블릿(600–1024), 데스크톱(≥1024) 3단 브레이크포인트.
- **타이포그래피**: M3 `display/title/body/label` 스케일 기반. 한글 본문 가독성 고려(라인 높이 1.5~1.7, 16–18pt).
- **컬러**: Seed Color 1개(브랜드)로 **Dynamic Scheme** 생성. 명암 대비(AA 이상), 상태색(성공/경고/오류) 토큰 정의.
- **아이코노그래피**: Material Symbols(Outlined) 우선.
- **간격/그리드**: 4px 베이스 스페이싱, 8/16/24 단위 권장. 데스크톱 카드/테이블 뷰는 12-column grid.
- **다크 모드**: M3 다크 팔레트 자동화(+ 명시 커스텀).
- **접근성**: 터치 타겟 ≥ 44×44px, 포커스 인디케이터, 스크린리더 라벨, 키보드 내비게이션.

> 디자이너 산출물은 Figma 기준 **토큰(색/타입/간격)**, **컴포넌트 라이브러리**, **레퍼런스 스크린**(모바일/데스크톱) 포함 권장.

---

## 3) 화면 인벤토리 & 핵심 플로우
### 핵심 모듈
1. 인증/계정: 로그인, 비밀번호 재설정, 2단계 인증(선택), 프로필
2. 대시보드: 공실/입주율, 연체 현황, 이번 달 수입/지출, 알림
3. 자산(건물/매물): 리스트/상세/CRUD, 검색·필터·정렬, 파일 업로드(등기/사진)
4. 유닛(호실): 리스트/상세/CRUD, 점유 상태, 면적/옵션
5. 세입자: 리스트/상세/CRUD, 연락처, 계약 이력
6. 계약(Lease): 작성/갱신/해지, 보증금/월세/기간, 첨부
7. 청구서/입금(Bill/Payment): 생성/발행/수납, 영수증, 엑셀 내보내기
8. 유지보수(Work Order): 접수/할당/처리/완료, 사진/코멘트
9. 리포트: 월별 수익, 공실율, 연체 리포트(내보내기)
10. 설정: 조직/역할/권한, 주소검색(다음/카카오), 통화/세율/형식, 통합(백엔드 API)

### 대표 사용자 흐름 예시
- **신규 계약 생성** → 유닛 선택 → 세입자 연결/신규 등록 → 조건(보증금/월세/기간) → 문서 업로드 → 서명(선택) → 청구 스케줄 생성 → 완료
- **월 청구 대량 발행** → 대상 계약 일괄 선택 → 금액/기한 확인 → 발행/알림 → 상태 모니터링 → 수납 처리

---

## 4) 컴포넌트 사양(요약)
- 내비게이션: 모바일 `NavigationBar` + 데스크톱 `NavigationRail`/`Drawer`
- 리스트: `PaginatedDataTable` 또는 커스텀 테이블(가상 스크롤), 컬럼 정렬/숨김, 고정 헤더
- 필터/검색: 쿼리 상태 URL 동기화(데스크톱), 모바일은 시트/다이얼로그
- 폼: `Form` + 유효성 검증(필수/형식/중복), KRW 화폐 입력, 날짜/기간 피커
- 업로드: 이미지/문서 미리보기, 드래그&드롭(데스크톱), 다중 선택
- 알림/토스트/다이얼로그: 비가림(Non-blocking) 우선, 파괴적 액션은 확인 필요
- 로딩/빈 상태: Skeleton, Empty state 가이드 텍스트
- 지도/주소: 다음 우편번호 검색(WebView/플러그인), 좌표 저장(선택)

---

## 5) RBAC(역할 기반 접근 제어)
### 권한 모델
- **역할(Roles)**: `OWNER`, `ADMIN`, `MANAGER`, `STAFF`, `ACCOUNTANT`, `READONLY`
- **권한(Permissions)**: 모듈×액션(`read/create/update/delete/export/approve` 등) 매트릭스
- **부여 방식**: 사용자→역할(N:N), 역할→권한(1:N), 조직/자산 스코프(선택)

### 권한 매트릭스(발췌)
| 모듈 \ 역할 | OWNER | ADMIN | MANAGER | STAFF | ACCOUNTANT | READONLY |
|---|---|---|---|---|---|---|
| 자산/유닛 | CRUD | CRUD | CRUD | R/U | R | R |
| 세입자 | CRUD | CRUD | CRUD | R/U | R | R |
| 계약 | CRUD | CRUD | CRUD | C/U | R | R |
| 청구/수납 | CRUD | CRUD | R/U | C/U | CRUD | R |
| 리포트 | CRUD | CRUD | R | R | R | R |
| 설정/역할 | CRUD | CRUD | R | - | - | - |

### Flutter 적용 지침
- **라우팅 가드**: `go_router`의 `redirect`에서 세션/권한 검사
- **위젯 가드**: `can('bills.create')` 헬퍼로 버튼/액션 노출 제어
- **서버 권한 재검증**: 민감 API는 서버에서 최종 검증(JWT scope/claim)

---

## 6) 아키텍처 & 상태관리(Flutter)
- **레이어드**: `presentation`(Widget) / `application`(usecase, provider) / `data`(repo, datasource)
- **상태관리**: `Riverpod`(또는 BLoC) + `Freezed`(불변/Union) + `json_serializable`
- **네트워킹**: `dio` + 인터셉터(인증/로깅/재시도/지수 백오프)
- **라우팅**: `go_router`(이름 기반, 딥링크, Web URL 동기화)
- **오프라인**: `drift`(SQLite) 또는 `isar` 캐시, Sync 전략(충돌 규칙 정의)
- **로깅/크래시**: `logger` + `sentry_flutter`(선택), 성능 추적
- **테스트**: 단위/위젯/골든 테스트, 통합 시나리오(계약 생성, 청구 대량 발행 등)

---

## 7) 데이터 모델(요약)
- `Property`, `Unit`, `Tenant`, `Lease`, `Bill`, `Payment`, `WorkOrder`, `User`, `Role`, `Permission`, `Attachment`, `AuditLog`
- ID는 ULID/UUID 권장. 금액은 정수(최소 화폐 단위) + 통화 코드, 날짜는 ISO-8601.
- 감사로그: 주체, 액션, 대상, 이전/이후 값, 시각, IP/UA

---

## 8) 백엔드 연동 계약(초안)
- **Auth**: `POST /auth/login` → JWT(roles/permissions 포함), 갱신 토큰
- **리스트 API**: 페이지네이션(`page/size`), 정렬(`sort=field,asc`), 필터(Query spec)
- **권한 검사**: 401/403 명확 구분, 에러 코드 표준화
- **대량 작업**: 청구서 일괄 발행/내보내기 비동기 Job + 폴링/웹훅(선택)

---

## 9) 디자인 산출물 체크리스트(필수)
- [ ] **스타일 가이드**(컬러/타입/아이콘/간격/그리드/다크)
- [ ] **컴포넌트 라이브러리**(버튼/입력/셀렉트/테이블/다이얼로그/토스트/탭/칩/피커)
- [ ] **화면별 와이어프레임**(모바일/데스크톱 페어)
- [ ] **사용자 흐름 프로토타입**(로그인→대시보드, 계약 생성, 청구 대량 발행)
- [ ] **개발 핸드오프**(레드라인/토큰/에셋 내보내기/명명 규칙)

---

## 10) 패키지 제안(참고)
- routing: `go_router`
- state: `flutter_riverpod`
- models: `freezed`, `json_serializable`
- http: `dio`
- form: `flutter_form_builder`(선택), `intl`(KRW/날짜)
- table: `data_table_2` 또는 커스텀
- db: `drift` 또는 `isar`
- error: `sentry_flutter`
- file: `file_picker`, `image_picker`
- storage: `firebase_storage`(선택) 또는 서버 업로드
- auth: `jwt_decode`, secure storage: `flutter_secure_storage`

---

## 11) 바로 필요한 결정 사항
1) 디자인 시스템: **Material 3 + 커스텀 토큰** 확정 여부  
2) 브레이크포인트/레이아웃 패턴(모바일 ↔ 데스크톱) 동시 지원 범위  
3) 상태관리: Riverpod vs BLoC 중 선택  
4) 데이터 테이블: 오픈소스 vs 상용(Syncfusion 등)  
5) 오프라인 지원 수준: 조회 캐시만 vs 편집까지 오프라인  
6) 주소/지도: 다음 우편번호 + 지도(선택) 정책  
7) 인증: JWT 클레임 내 권한 스키마 및 만료/갱신 정책

---

## 12) 수용 기준(예시)
- 대시보드(데스크톱): 지표 카드·테이블 60fps 스크롤, 1200px 폭 기준 반응형 OK
- 리스트: 1만 건 가상 스크롤, 컬럼 정렬/필터/페이지 유지, 새로고침 후 상태 보존
- 폼: 실시간 검증, 엔터/탭 내비게이션, 자동 포맷(KRW/날짜), 접근성 라벨 OK
- RBAC: 권한 없는 액션/라우트는 UI 비노출 + 서버 403 방어
- 오류 처리: 네트워크/인증 만료/중복 입력 케이스별 사용자 메시지

---

## 13) 다음 액션
- 위 **체크리스트**에 맞춘 Figma 파일 또는 텍스트 와이어프레임 초안을 제공하면, 즉시 Flutter 프로젝트 스캐폴딩(패키지/폴더/테마/라우팅/RBAC 가드 골격)까지 생성 가능한 수준으로 구체화하겠습니다.
