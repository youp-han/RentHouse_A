<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ìš°í¸ë²ˆí˜¸ ê²€ìƒ‰ (Simple WebView + LocalhostServer)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #ffffff;
        }
        #postcode_layer {
            width: 100%;
            height: 100vh;
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-size: 16px;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">ìš°í¸ë²ˆí˜¸ ì„œë¹„ìŠ¤ë¥¼ ë¡œë”©í•˜ëŠ” ì¤‘...</div>
    <div id="postcode_layer" style="display: none;"></div>

    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
        console.log('ğŸš€ Simple WebView (LocalhostServer): Script started');

        // Daum Postcode ì´ˆê¸°í™”
        function initPostcode() {
            try {
                console.log('ğŸ“ Simple WebView: Daum Postcode ì´ˆê¸°í™” ì¤‘...');
                document.getElementById('loading').style.display = 'none';
                document.getElementById('postcode_layer').style.display = 'block';

                new daum.Postcode({
                    oncomplete: function(data) {
                        console.log('ğŸ¯ â˜…â˜…â˜… Simple WebView: Daum oncomplete í˜¸ì¶œë¨! â˜…â˜…â˜…');
                        console.log('ğŸ“‹ Simple WebView: ìˆ˜ì‹ ëœ ë°ì´í„°:', data);

                        const result = {
                            zonecode: data.zonecode,
                            address: data.address,
                            roadAddress: data.roadAddress || data.address,
                            jibunAddress: data.jibunAddress,
                            buildingName: data.buildingName || ''
                        };

                        try {
                            console.log('ğŸ“¤ Simple WebView: Flutterë¡œ ë°ì´í„° ì „ì†¡ ì¤‘...');
                            console.log('ğŸ“¦ ì „ì†¡í•  ë°ì´í„°:', result);

                            // Flutter í•¸ë“¤ëŸ¬ í˜¸ì¶œ
                            window.flutter_inappwebview.callHandler('addressSelected', result)
                                .then(function(response) {
                                    console.log('âœ… Flutter í•¸ë“¤ëŸ¬ ì‘ë‹µ:', response);
                                    // ì£¼ì†Œ ì„ íƒ í›„ ì°½ ë‹«ê¸°
                                    setTimeout(function() {
                                        console.log('ğŸ”„ ì£¼ì†Œ ì„ íƒ ì™„ë£Œ, ì°½ ë‹«ê¸° ì‹œë„...');
                                        window.flutter_inappwebview.callHandler('closeWindow');
                                    }, 500);
                                })
                                .catch(function(error) {
                                    console.error('âŒ Flutter í•¸ë“¤ëŸ¬ ì˜¤ë¥˜:', error);
                                });

                        } catch (e) {
                            console.error('âŒ Simple WebView: í•¸ë“¤ëŸ¬ í˜¸ì¶œ ì‹¤íŒ¨', e);
                            // ì—ëŸ¬ ë°œìƒì‹œì—ë„ ì°½ ë‹«ê¸° ì‹œë„
                            try {
                                window.flutter_inappwebview.callHandler('closeWindow');
                            } catch (closeError) {
                                console.error('âŒ ì°½ ë‹«ê¸°ë„ ì‹¤íŒ¨:', closeError);
                            }
                        }
                    },
                    onclose: function(state) {
                        console.log('ğŸšª Simple WebView: Daum onclose í˜¸ì¶œë¨, state:', state);
                        if (state === 'FORCE_CLOSE') {
                            try {
                                console.log('ğŸ’ª ê°•ì œ ì¢…ë£Œë¡œ ì¸í•œ ì°½ ë‹«ê¸°...');
                                window.flutter_inappwebview.callHandler('closeWindow');
                            } catch (e) {
                                console.error('âŒ oncloseì—ì„œ ì°½ ë‹«ê¸° ì‹¤íŒ¨:', e);
                            }
                        }
                    },
                    width: '100%',
                    height: '100%',
                    animation: false
                }).embed(document.getElementById('postcode_layer'));

                console.log('âœ… Simple WebView: Daum Postcode ì„ë² ë“œ ì™„ë£Œ');
            } catch (error) {
                console.error('âŒ Simple WebView: Postcode ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                document.getElementById('loading').innerHTML = 'ì£¼ì†Œ ê²€ìƒ‰ ì„œë¹„ìŠ¤ ë¡œë”© ì‹¤íŒ¨<br>ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
            }
        }

        // Daum API ë¡œë”© ëŒ€ê¸°
        function waitForDaumAPI() {
            console.log('â³ Flutter í†µì‹  í™˜ê²½ í™•ì¸...');
            console.log('ğŸ” window.flutter_inappwebview ì¡´ì¬:', !!window.flutter_inappwebview);
            console.log('ğŸ” callHandler í•¨ìˆ˜ ì¡´ì¬:', !!(window.flutter_inappwebview && window.flutter_inappwebview.callHandler));

            if (typeof daum !== 'undefined' && typeof daum.Postcode !== 'undefined') {
                console.log('âœ… Daum API ë¡œë”© ì™„ë£Œ, ì´ˆê¸°í™” ì‹œì‘');
                initPostcode();
            } else {
                console.log('â³ Daum API ë¡œë”© ëŒ€ê¸° ì¤‘...');
                setTimeout(waitForDaumAPI, 200);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸°í™”
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                console.log('ğŸ“„ DOMContentLoaded - 1ì´ˆ í›„ ì´ˆê¸°í™” ì‹œì‘');
                setTimeout(waitForDaumAPI, 1000);
            });
        } else {
            console.log('ğŸ“„ Document already loaded - 1ì´ˆ í›„ ì´ˆê¸°í™” ì‹œì‘');
            setTimeout(waitForDaumAPI, 1000);
        }
    </script>
</body>
</html>